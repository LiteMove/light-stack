# LightStack-Go 开发指南

> 基于 Go + Vue 3 的全栈轻量级开发框架

## 项目架构

### 后端架构 (Go)

```
github.com/LiteMove/light-stack/
├── cmd/                    # 可执行文件入口
│   ├── server/            # 服务器启动入口
│   ├── migrate/           # 数据库迁移工具
│   └── test/              # 测试工具
├── internal/              # 内部应用代码
│   ├── config/            # 配置管理
│   ├── controller/        # 控制器层
│   ├── middleware/        # 中间件
│   ├── model/             # 数据模型
│   ├── repository/        # 数据访问层
│   ├── service/           # 业务逻辑层
│   └── utils/             # 内部工具函数
├── pkg/                   # 可复用的公共包
│   ├── cache/            # Redis缓存组件
│   ├── database/         # 数据库连接组件
│   ├── logger/           # 日志组件
│   ├── response/         # 统一响应组件
│   └── jwt/              # JWT认证组件(待实现)
├── configs/               # 配置文件
├── web/                  # 前端Vue应用
└── doc/                  # 项目文档
```

### 前端架构 (Vue 3)

```
web/
├── src/
│   ├── components/       # 通用组件
│   ├── views/           # 页面组件
│   ├── router/          # 路由配置
│   ├── store/           # Pinia状态管理
│   ├── api/            # API请求封装
│   ├── utils/          # 工具函数
│   └── assets/         # 静态资源
├── public/             # 公共资源
└── package.json        # 依赖配置
```

## 核心组件

### 1. 配置管理组件 (`internal/config`)

**位置**: `internal/config/config.go`

**功能**:
- 统一配置管理，支持YAML格式
- 环境变量覆盖配置
- 多环境配置支持

**使用方式**:
```go
// 初始化配置
config.Init()

// 获取配置
cfg := config.Get()

// 检查环境
if config.IsProduction() {
    // 生产环境逻辑
}
```

**配置项**:
- `app`: 应用基础配置
- `server`: 服务器配置
- `database`: 数据库配置
- `redis`: Redis配置
- `jwt`: JWT认证配置
- `log`: 日志配置

### 2. 统一响应组件 (`pkg/response`)

**位置**: `pkg/response/response.go`

**功能**:
- 统一API响应格式
- 标准化错误处理
- 分页数据响应

**响应结构**:
```go
type Response struct {
    Code      int         `json:"code"`
    Message   string      `json:"message"`
    Data      interface{} `json:"data"`
    Timestamp int64       `json:"timestamp"`
}
```

**使用方式**:
```go
// 成功响应
response.Success(c, data)

// 错误响应
response.Error(c, 400, "参数错误")

// 快捷错误响应
response.BadRequest(c, "参数验证失败")
response.Unauthorized(c, "未授权")
response.NotFound(c, "资源不存在")

// 分页响应
response.SuccessWithPage(c, list, total, page, pageSize)
```

### 3. 日志组件 (`pkg/logger`)

**位置**: `pkg/logger/logger.go`

**功能**:
- 基于logrus的日志管理
- 支持多种日志级别和格式
- 文件和控制台输出

**使用方式**:
```go
// 初始化日志
logger.Init()

// 使用日志
logger.Info("服务启动")
logger.Error("发生错误")
logger.WithField("user_id", 123).Info("用户操作")
logger.WithFields(logrus.Fields{
    "module": "auth",
    "action": "login",
}).Info("用户登录")
```

### 4. 数据库组件 (`pkg/database`)

**位置**: `pkg/database/database.go`

**功能**:
- 基于GORM的MySQL数据库连接
- 连接池管理
- 自动配置

**使用方式**:
```go
// 初始化数据库
database.Init()

// 获取数据库实例
db := database.GetDB()

// 使用GORM操作数据库
db.Create(&user)
db.First(&user, id)
```

### 5. Redis缓存组件 (`pkg/cache`)

**位置**: `pkg/cache/redis.go`

**功能**:
- Redis连接管理
- 常用缓存操作封装
- 哈希操作支持

**使用方式**:
```go
// 初始化Redis
cache.Init()

// 基本操作
cache.Set("key", "value", time.Hour)
value, err := cache.Get("key")
cache.Del("key")

// 哈希操作
cache.HSet("user:123", "name", "张三")
name, err := cache.HGet("user:123", "name")

// 检查存在
exists, err := cache.Exists("key")
```

### 6. 中间件组件 (`internal/middleware`)

**位置**: `internal/middleware/response.go`

**已实现中间件**:
- `ResponseMiddleware`: 响应处理和错误恢复
- `RequestLogMiddleware`: 请求日志记录

**使用方式**:
```go
r.Use(middleware.ResponseMiddleware())
r.Use(middleware.RequestLogMiddleware())
```

### 7. 路由控制器 (`internal/controller`)

**位置**: `internal/controller/routes.go`

**功能**:
- 路由注册和管理
- 控制器模式
- API版本控制

**使用方式**:
```go
// 注册路由
controller.RegisterRoutes(r)

// 创建新控制器
type UserController struct{}

func (u *UserController) Create(c *gin.Context) {
    // 业务逻辑
    response.Success(c, result)
}
```

## 前端技术栈

### Vue 3 生态

**核心依赖**:
- `vue@^3.3.4`: Vue 3框架
- `vue-router@^4.2.4`: 路由管理
- `pinia@^2.1.6`: 状态管理
- `element-plus@^2.3.8`: UI组件库
- `axios@^1.4.0`: HTTP客户端
- `@element-plus/icons-vue@^2.1.0`: 图标库
- `nprogress@^0.2.0`: 进度条

**开发工具**:
- `vite@^4.4.5`: 构建工具
- `typescript@^5.1.6`: TypeScript支持
- `eslint`: 代码规范
- `prettier`: 代码格式化

## 开发约定

### 1. 目录结构约定

- `cmd/`: 只放可执行文件的main函数
- `internal/`: 应用内部代码，不被外部导入
- `pkg/`: 可被外部项目复用的代码
- `configs/`: 配置文件存放目录

### 2. 命名约定

**Go代码**:
- 包名：小写字母，简短明确
- 函数名：驼峰命名，导出函数首字母大写
- 结构体：驼峰命名，导出结构体首字母大写
- 接口：以-er结尾或描述性名称

**Vue代码**:
- 组件名：PascalCase
- 文件名：kebab-case
- 变量名：camelCase

### 3. 错误处理约定

**Go错误处理**:
```go
if err != nil {
    logger.Error("操作失败", err)
    response.InternalServerError(c, "系统错误")
    return
}
```

**Vue错误处理**:
```javascript
try {
    const result = await api.getData()
    // 处理成功逻辑
} catch (error) {
    ElMessage.error('操作失败')
    console.error(error)
}
```

### 4. API设计约定

**URL设计**:
```
GET    /api/v1/users        # 获取用户列表
POST   /api/v1/users        # 创建用户
GET    /api/v1/users/:id    # 获取用户详情
PUT    /api/v1/users/:id    # 更新用户
DELETE /api/v1/users/:id    # 删除用户
```

**响应格式**:
```json
{
    "code": 200,
    "message": "success",
    "data": {},
    "timestamp": 1634567890
}
```

## 开发工具使用

### 1. 启动开发环境

**后端**:
```bash
# 安装依赖
go mod tidy

# 启动服务
go run cmd/server/main.go

# 或使用Makefile
make run
```

**前端**:
```bash
cd web
npm install
npm run dev
```

### 2. 数据库迁移

```bash
# 执行迁移
go run cmd/migrate/main.go
```

### 3. 代码格式化

**Go代码**:
```bash
go fmt ./...
goimports -w .
```

**Vue代码**:
```bash
cd web
npm run lint
npm run format
```

## 快速开发指南

### 1. 添加新的API接口

1. 在`internal/controller`中创建控制器
2. 在`controller/routes.go`中注册路由
3. 使用`pkg/response`返回统一格式

### 2. 添加新的数据模型

1. 在`internal/model`中定义结构体
2. 在`internal/repository`中实现数据访问
3. 在`internal/service`中实现业务逻辑

### 3. 添加新的中间件

1. 在`internal/middleware`中实现中间件函数
2. 在`cmd/server/main.go`中注册使用

### 4. 添加新的工具组件

1. 在`pkg/`目录下创建新包
2. 实现初始化和常用操作函数
3. 在`cmd/server/main.go`中初始化

### 5. 前端开发

1. 在`web/src/api`中定义API接口
2. 在`web/src/views`中创建页面组件
3. 在`web/src/router`中配置路由
4. 使用Element Plus组件库快速构建UI

## 部署指南

### 1. 构建

**后端**:
```bash
make build
# 或
go build -o bin/server cmd/server/main.go
```

**前端**:
```bash
cd web
npm run build
```

### 2. 配置

创建生产环境配置文件`configs/config.yaml`:
```yaml
app:
  mode: production
database:
  host: your-db-host
  password: your-db-password
redis:
  host: your-redis-host
  password: your-redis-password
```

### 3. 运行

```bash
./bin/server
```

---

**注意**: 此文档基于当前项目实现状态生成，部分组件(如JWT)可能还在开发中。在使用AI进行后续开发时，请参考此文档中的组件和约定，确保代码风格和架构的一致性。